<style lang="less">
  @import "../style/index.less";
</style>

<template>
  <div v-if="coasterImg" class="beer">
    <gwi-coaster
      :img="coasterImg"
    ></gwi-coaster>
    <div class="beer_text">
      <gwi-beer-info
        :name="beer.name"
        :average-vote="beer.averageVote"
      ></gwi-beer-info>
      <gwi-vote
        :vote="userVote"
        @vote="updateVote"
      ></gwi-vote>
    </div>
    
  </div>
</template>

<script>
  import { mapGetters, mapActions } from 'vuex'
  import beerInfo from 'component_beer-info'
  import vote from 'component_vote'
  import coaster from 'element_coaster'
  
  export default {
    components: {
      'gwi-beer-info': beerInfo,
      'gwi-vote': vote,
      'gwi-coaster': coaster
    },
    props: ['beer', 'beerIndex'],
    computed: {
      userVote () {
        var votes = this.beer.votes
        for (var i = 0; i < votes.length; i++) {
          let vote = votes[i]
          if (vote.user.localeCompare(this.user.id) === 0) {
            return vote
          }
        }
      },
      coasterImg () {
        return this.beer.images[0]
      },
      ...mapGetters({
        user: 'user'
      })
    },
    methods: {
      updateVote(value) {
        this.putVote({ index: this.beerIndex, vote: {user: this.user.id, name: this.user.name, vote: value.vote, statement: value.statement} })
        this.active = false
      },
      ...mapActions({
        putVote: 'beers_vote'
      })
    }
  }
</script>
<style lang="less">
  @import "../style/index.less";
</style>

<template>
  
  <div class="user">
    <div
      v-if="!userName"
      class="user_loggedOut"
    >
      <input
        type="text"
        placeholder="put your name here first"
        v-model="inputUserName"
        @keyup.enter="saveUser"
      >
      <button
        @click="saveUser"
        @enter="saveUser"
      >save
      </button>
    </div>
    <div
      v-if="userName"
      class="user_loggedIn"
    >
      Hello {{userName}} - please put your vote:
    </div>
  </div>
</template>

<script>
  import { mapGetters, mapActions } from 'vuex'
  export default {
    data () {
      return {
        inputUserName: ''
      }
    },
    computed: {
      userId: {
        cache: false,
        get () {
          return this.user.id
        },
        set ( newValue ) {
          return // readonly
        }
      },
      userName: {
        get () {
          return this.user.name
        },
        set ( newValue ) {
          newValue = newValue || ''
          var id = encodeURI( newValue.replace( / /g, '_' ).toLowerCase() )
          this.storeUser({id, name: newValue})
        }
      },
      ...mapGetters({
        user: 'user'
      })
    },
    methods: {
      saveUser () {
        this.userName = this.inputUserName
      },
      ...mapActions({
        storeUser: 'user_set'
      })
    },
    created () {
      this.$emit('user', {id: this.userId, name: this.userName})
    }
  }
</script>